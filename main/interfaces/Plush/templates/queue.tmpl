<%
def InjectProgressBarPosition (mbleft, mb):
	if mb == '0.00': # don't divide by zero
		return '-120px -1px;'
	percentage = int(100 - float(mbleft) / float(mb) * 100)
	postion =  int(120 - 120.0 / 100.0 * percentage)
	return '-'+str(postion)+'px -1px;'
%>

<script type="text/javascript">
	
	if (\$("#maxSpeed-option").val() != '$speedlimit' && !focusedOnSpeedChanger)
		\$("#maxSpeed-option").val('$speedlimit');
	if (\$("#onQueueFinish-option").val() != '$finishaction')
		\$("#onQueueFinish-option").val('$finishaction');
	
	var paused = <!--#if $paused#-->true<!--#else#-->false<!--#end if#-->;
	if ( paused && \$('#pause_resume').attr('class') != 'tip q_menu_pause q_menu_paused')
		\$('#pause_resume').attr('class','tip q_menu_pause q_menu_paused');
	else if ( !paused && \$('#pause_resume').attr('class') != 'tip q_menu_pause q_menu_unpaused')
		\$('#pause_resume').attr('class','tip q_menu_pause q_menu_unpaused');
	
	<!--#if $noofslots < 1#-->
	document.title = '<!--#if $paused#-->PAUSED<!--#else#-->READY<!--#end if#--> | SABnzbd+ Plush';
	\$('#stats_kbpersec').html('&mdash;');
	\$('#stats_eta').html('&mdash;');
	<!--#else if $paused#-->
	document.title = 'PAUSED | <!--#echo "%.0f" % float($mbleft)#--> MB left | $noofslots NZBs';
	\$('#stats_kbpersec').html('&mdash;');
	\$('#stats_eta').html('&mdash;');
	<!--#else#-->
	document.title = '<!--#echo "%.0f" % float($kbpersec)#--> KB/s | <!--#echo "%.0f" % float($mbleft)#--> MB | $timeleft left';
	\$('#stats_kbpersec').html('<!--#echo "%.0f" % float($kbpersec)#-->');
	\$('#stats_eta').html('$timeleft');
	<!--#end if#-->
	\$('#stats_eta').attr('title','ETA: $eta');

	RefreshTime = 5;
	var cookietimeout;

	function checkCookie()
	{
	var speedlog = [];
	cook=ReadCookie('speedlog2');

		if (cook!=null && cook!="")
		{
			var speedlog = cook.split(',');
			for(i=1; i<21; i++) 
			{
				speedlog[i-1] = speedlog[i];
			}

			speedlog[20] = <!--#echo "%.0f" % float($kbpersec)#-->;

			var speedstr = speedlog.join(',');
			SetCookie('speedlog2',speedstr,1);

			//drawGraph(speedlog);
			chartReload(speedlog);
		}
		else
		{
			SetCookie('speedlog2','0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,<!--#echo "%.0f" % float($kbpersec)#-->',1);
		}

	}
	function chartReload(data)
	{
		\$.plot(\$("#chart"),[ [ [0, data[0]], [1, data[1]], [2, data[2]], [3, data[3]], [4, data[4]], [5, data[5]], [6, data[6]], [7, data[7]], [8, data[8]],[9, data[9]],[10, data[10]], [11, data[11]],  [12, data[12]], [13, data[13]], [14, data[14]], [15, data[15]], [16, data[16]], [17, data[17]], [18, data[18]],[19, data[19]],[20, data[20]]]],{ yaxis: { min: 0 }, xaxis: { ticks: []} });
	}
	checkCookie();
</script>

<div class="box_banner_hr"></div>

<span id="stats_noofslots">$noofslots</span>

<table class="queueTable" id="queueTable">
<!--#set $cur = 0#-->
<!--#set $odd = False#-->
<!--#if $varExists('slotinfo')#-->
<!--#for $slot in $slotinfo#-->
	<!--#if $limit == 0 or $cur < $limit#-->
	<!--#set $cur = $cur + 1#-->
	<!--#set $odd = not $odd#-->
	<tr id="$slot.nzo_id"<!--#if $odd#--> class="alt"<!--#end if#-->>
	
	<td title="Average File Age: $slot.avg_age" class="download-title">
		<div class="title"></div>
		<a href="queue/$slot.nzo_id/">$slot.filename</a>
	</td>
	
	<td class="queueProgressBarContainer">
		<div class="queueProgressBar" style="background-position: <%=InjectProgressBarPosition(slot['mbleft'],slot['mb'])%>">
			<div class="totalDownload"><%=int(float(slot['mbleft']))%>&nbsp;<small>left</small></div>
			<div class="currentDownload"><%=int(float(slot['mb']))%>&nbsp;<small>MB</small></div>
		</div>
	</td>
	
	<td class="eta">
		<!--#if not $paused#-->
		$slot.timeleft&nbsp;left<br/>$slot.eta
		<!--#else#-->
		&nbsp;<br/>&nbsp;
		<!--#end if#-->
	</td>
	
	<td class="options">
		<div class="queue_delete" title="Remove&nbsp;NZB">&nbsp;&nbsp;&nbsp;</div>
		<!--#if $cat_list#-->
		<select title="Category" class="proc_category">
			<!--#for $ct in $cat_list#-->
			<option value="$ct" <!--#if $slot.cat.lower() == $ct.lower() then "selected" else ""#-->>$ct</option>
			<!--#end for#-->
		</select>
		<!--#end if#-->
		<select title="Processing Option" class="proc_option">
			<option value="0" <!--#if $slot.unpackopts == "0" then "selected " else ""#-->>Skip</option>
			<option value="1" <!--#if $slot.unpackopts == "1" then "selected " else ""#-->>+Repair</option>
			<option value="2" <!--#if $slot.unpackopts == "2" then "selected " else ""#-->>+R+Unpack</option>
			<option value="3" <!--#if $slot.unpackopts == "3" then "selected " else ""#-->>+R+U+Delete</option>
		</select>
		<!--#if $script_list#-->
		<select title="Script" class="proc_script">
			<!--#for $sc in $script_list#-->
			<option value="$sc"  <!--#if $slot.script == $sc then "selected" else ""#-->>$sc</option>
			<!--#end for#-->
		</select>
		<!--#end if#-->
	</td>
	
	</tr>
	<!--#end if#-->
<!--#end for#-->
<!--#end if#-->
</table>

<div class="box_fatbottom">
	
	<div class="right_stats">
		<!--#if $varExists('slotinfo')#-->
		<strong>$mbleft&nbsp;of&nbsp;$mb&nbsp;MB</strong>&nbsp;Remaining&nbsp;&nbsp;&nbsp;&nbsp;
		<!--#end if#-->
		<!--#if $diskspace1 == $diskspace2#-->
		<strong class="<!--#if float($diskspace1) < float($mb)/1024 #-->stats_incomplete_freespace_needspace" title="Not enough disk space to complete downloads!<!--#else#-->stats_incomplete_freespace<!--#end if#-->">$diskspace1&nbsp;GB</strong>&nbsp;Free&nbsp;Space</small></span>
		<!--#else#-->
		<strong class="<!--#if float($diskspace1) < float($mb)/1024 #-->stats_incomplete_freespace_needspace" title="Not enough disk space to complete downloads!<!--#else#-->stats_incomplete_freespace<!--#end if#-->">$diskspace1&nbsp;GB</strong>&nbsp;Free&nbsp;(Temp)
		<strong class="<!--#if float($diskspace2) < float($mb)/1024 #-->stats_complete_freespace_needspace" title="Not enough disk space to complete downloads!<!--#else#-->stats_complete_freespace<!--#end if#-->">$diskspace2&nbsp;GB</strong>&nbsp;Free&nbsp;Space
		<!--#end if#-->
	</div>
	
	<div class="left_stats">
		<small>Showing:</small>&nbsp;<select id="queue_view_preference">
			<option value="0"<!--#if $limit==0#--> selected<!--#end if#-->>Everything</option>
			<option value="1"<!--#if $limit==1#--> selected<!--#end if#-->>#1 Only</option>
			<option value="2"<!--#if $limit==2#--> selected<!--#end if#-->>Top 2</option>
			<option value="5"<!--#if $limit==5#--> selected<!--#end if#-->>Top 5</option>
			<option value="10"<!--#if $limit==10#--> selected<!--#end if#-->>Top 10</option>
			<option value="15"<!--#if $limit==15#--> selected<!--#end if#-->>Top 15</option>
			<option value="20"<!--#if $limit==20#--> selected<!--#end if#-->>Top 20</option>
			<option value="25"<!--#if $limit==25#--> selected<!--#end if#-->>Top 25</option>
			<option value="30"<!--#if $limit==30#--> selected<!--#end if#-->>Top 30</option>
			<option value="40"<!--#if $limit==40#--> selected<!--#end if#-->>Top 40</option>
			<option value="50"<!--#if $limit==50#--> selected<!--#end if#-->>Top 50</option>
			<option value="100"<!--#if $limit==100#--> selected<!--#end if#-->>Top 100</option>
			<option value="200"<!--#if $limit==200#--> selected<!--#end if#-->>Top 200</option>
		</select>&nbsp;<small>of</small>&nbsp;<strong>$noofslots</strong>&nbsp;<small>NZB<!--#if $noofslots != 1 #-->s<!--#end if#--></small>&nbsp;&nbsp;&nbsp;&nbsp;
		<span id="skipped_refresh" style="display:none;">&raquo;&nbsp;Skipped&nbsp;last&nbsp;refresh</span>
	</div>
	
</div>
