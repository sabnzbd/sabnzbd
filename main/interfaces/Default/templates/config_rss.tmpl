<!--#set global $topmenu="config"#-->
<!--#set global $statpath="../.."#-->
<!--#set global $helpsubject="Configure+RSS"#-->
<!--#include $webdir + "/inc_top.tmpl"#-->

<!--#set global $submenu="rss"#-->
<!--#include $webdir + "/inc_cmenu.tmpl"#-->

<h2>RSS Configuration</h2>
<!--#if $have_feedparser#-->

<div class="EntryBlock">
<form action="add_rss_feed" method="post">
<fieldset class="EntryFieldSet">
<legend>New feed URI</legend>
    <input type="text" size="10" name="feed" value="$feed"/>&nbsp;
    <input type="text" size="104" name="uri" value=""/><br/><br/>
    <input type="submit" value="Add"/>
</fieldset>
</form>
</div>

<p>The checkbox next to the feed name should be ticked for the feed to be enabled and be automatically checked for new items.<br />
The checking frequency is in the General page of the configuration<br />
When a feed is added, it will only pick up new items and not anything already in the RSS feed unless you press "Force Download"</p>

<!--#for $feed in $rss#-->
    <h3>Feed Definition</h3>
    <div class="EntryBlock">
    <form action="upd_rss_feed" method="post">
        <fieldset class="EntryFieldSet">
            <legend <!--#if $rss[$feed]['enable'] then 'class="feedEnabled"' else 'class="feedDisabled"'#-->><input type="checkbox" onclick="this.form.action='toggle_rss_feed';  this.form.submit(); return false;" name="enable" <!--#if $rss[$feed]['enable'] then "CHECKED" else "" #-->/>
            Feed $feed</legend>

            <input type="text" size="105" name="uri" value="$rss[$feed]['uri']"/>
            <input type="submit" onclick="this.form.action='del_rss_feed';  this.form.submit(); return false;" value="Delete Feed"/>
            <input type="submit" onclick="this.form.action='test_rss_feed'; this.form.submit(); return false;" value="Preview"/>
            <input type="submit" onclick="this.form.action='download_rss_feed'; this.form.submit(); return false;" value="Force Download"/>
            <br/><br/>

            <!--#if $rss[$feed]['pick_cat']#-->
                <select name="cat">
                <!--#for $ct in $cat_list#-->
                    <option value="$ct" <!--#if $ct == $rss[$feed]['cat'] then "selected" else ""#-->>$ct</option>
                <!--#end for#-->
                </select>
            <!--#end if#-->
            <select name="pp">
                <option value="" <!--#if $rss[$feed]['pp'] == "" then 'selected' else ''#-->>Default</option>
                <option value="0" <!--#if $rss[$feed]['pp'] == "0" then 'selected' else ''#-->>Download</option>
                <option value="1" <!--#if $rss[$feed]['pp'] == "1" then 'selected' else ''#-->>+Repair</option>
                <option value="2" <!--#if $rss[$feed]['pp'] == "2" then 'selected' else ''#-->>+Unpack</option>
                <option value="3" <!--#if $rss[$feed]['pp'] == "3" then 'selected' else ''#-->>+Delete</option>
            </select>
            <!--#if $rss[$feed]['pick_script']#-->
                <select name="script">
                <!--#for $sc in $script_list#-->
                    <option value="$sc" <!--#if $sc == $rss[$feed]['script'] then "selected" else ""#-->>$sc</option>
                <!--#end for#-->
                </select>
            <!--#end if#-->
            <select name="priority">
                <option value="1" <!--#if $rss[$feed]['priority'] == 1 then 'selected' else ''#-->>High</option>
                <option value="0" <!--#if $rss[$feed]['priority'] == 0 then 'selected' else ''#-->>Normal</option>
                <option value="-1" <!--#if $rss[$feed]['priority'] == -1 then 'selected' else ''#-->>Low</option>
            </select>

            <input type="hidden" name="feed" value="$feed"/>
            <input type="submit" value="Save"/>
            <br />
        
    </form>

    <br/><br/>

    <table>
        <tr>
            <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
            <th>Order</th>
            <th>Type</th>
            <th>Filter</th>
            <!--#if $rss[$feed]['pick_cat'] then "<th>Category</th>" else ""#-->
            <th>Mode</th>
            <!--#if $rss[$feed]['pick_script'] then "<th>Script</th>" else ""#-->
            <th></th>
        </tr>

        <form action="upd_rss_filter" method="get">
        <tr class="odd">
        <td></td>
        <td></td>
        <td>
            <select name="filter_type">
                <option value="A" selected /> Accept</option>
                <option value="R" /> Reject</option>
            </select>
        </td>
        <td><input type="text" size="60" name="filter_text" value=""></td>
        <!--#if $rss[$feed]['pick_cat']#-->
          <td>
            <select name="cat">
            <!--#for $ct in $cat_list#-->
                <option value="$ct" <!--#if $ct == $rss[$feed]['cat'] then "selected" else ""#-->>$ct</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->
        <td>
          <select name="pp">
              <option value="" <!--#if $rss[$feed]['pp'] == "0" then 'selected' else ''#-->>Default</option>
              <option value="0" <!--#if $rss[$feed]['pp'] == "0" then 'selected' else ''#-->>Download</option>
              <option value="1" <!--#if $rss[$feed]['pp'] == "1" then 'selected' else ''#-->>+Repair</option>
              <option value="2" <!--#if $rss[$feed]['pp'] == "2" then 'selected' else ''#-->>+Unpack</option>
              <option value="3" <!--#if $rss[$feed]['pp'] == "3" then 'selected' else ''#-->>+Delete</option>
          </select>
        </td>
        <!--#if $rss[$feed]['pick_script']#-->
          <td>
            <select name="script">
            <!--#for $sc in $script_list#-->
                <option value="$sc" <!--#if $sc == $rss[$feed]['script'] then "selected" else ""#-->>$sc</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->
        <input type="hidden" value="$rss[$feed]['filtercount']" name="index">
        <input type="hidden" value="$feed" name="feed">
        <td><input type="submit" value="Save"></td>
        </tr>
        </form>

    <!--#set $fnum = 0#-->
    <!--#for $filter in $rss[$feed].filters#-->
        <tr class="odd">
        <td>
            <form action="del_rss_filter" method="post">
            <input type="hidden" value="$fnum" name="index">
            <input type="hidden" value="$feed" name="feed">
            <input type="submit" value="X"></form>
        </td>

        <td><form><select onchange="location = this.options[this.selectedIndex].value;">
        <!--#for $i in xrange($rss[$feed]['filtercount'])#-->
            <option value="pos_rss_filter?feed=$feed&current=$fnum&new=$i" <!--#if int($i) == int($fnum) then "selected" else ""#-->>$i</option>
        <!--#end for#-->
        </select>
        <input type="hidden" value="$feed" name="feed">
        </form></td>

        <form action="upd_rss_filter" method="get">
        <td>
        <select name="filter_type">
            <option value="A" <!--#if $filter[3] == "A" then "selected" else ""#--> /> Accept</option>
            <option value="R" <!--#if $filter[3] == "R" then "selected" else ""#--> /> Reject</option>
        </select>
        </td>

        <td><input type="text" size="60" name="filter_text" value="$filter[4]"/></td>
        <!--#if $rss[$feed]['pick_cat']#-->
          <td>
            <select name="cat">
            <!--#for $ct in $cat_list#-->
                <option value="$ct" <!--#if $ct == $filter[0] then "selected" else ""#-->>$ct</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->
        <td>
        <select name="pp">
            <option value="" <!--#if $filter[1] == "0" then 'selected' else ''#-->>Default</option>
            <option value="0" <!--#if $filter[1] == "0" then 'selected' else ''#-->>Download</option>
            <option value="1" <!--#if $filter[1] == "1" then 'selected' else ''#-->>+Repair</option>
            <option value="2" <!--#if $filter[1] == "2" then 'selected' else ''#-->>+Unpack</option>
            <option value="3" <!--#if $filter[1] == "3" then 'selected' else ''#-->>+Delete</option>
        </select>
        </td>
        <!--#if $rss[$feed]['pick_script']#-->
          <td>
            <select name="script">
            <!--#for $sc in $script_list#-->
                <option value="$sc" <!--#if $sc == $filter[2] then "selected" else ""#-->>$sc</option>
            <!--#end for#-->
            </select>
          </td>
        <!--#end if#-->
        <td>
        <input type="hidden" name="index" value="$fnum"/>
        <input type="hidden" name="feed" value="$feed"/>
        <input type="submit" value="Save"/>
        </td>
        </form>
        </tr>
        <!--#set $fnum = $fnum+1#-->
    <!--#end for#-->

    </table>
    </div>
    </fieldset>
<!--#end for#-->

<!--#else#-->
    <p>
        <b>feedparser module missing<b>
    </p>
<!--#end if#-->

<!--#include $webdir + "/inc_bottom.tmpl"#-->
